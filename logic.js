var tests = [["Биология - Учёные",["*img*гиппократ.jpeg","*img*клавдий_гален.webp","*img*абу_али_ибн_сина.jpg","*img*уильям гарвей.webp","*img*пирогов.webp","*img*сеченов.jpeg","*img*пастер.jpg","*img*мечников.jpg","*img*карл_линней.jpg","*img*бюффон.jpg","*img*ламарк.jpg","*img*дарвин.jpg"],["Гиппократ (ок. 460 - ок. 370 до н.э.) - создал учение о четырёх возможных типах телосложения и темперамента, собрал имеющиеся знания о строении человека","Клавдий Гален (ок. 130 - ок. 220) - написал 83 важных труда по анатомии и медицине, стал основателем фармакологии","Абу Али ибн Сина (980 - 1037) - создал важные труды по медицине","Уильям Гарвей (1578 - 1657) - первый физиолог, доказал, что кровь движется по двум замкнутым кругам, а центр - сердце","Пирогов (1810 - 1881) - впервые применил эфир для наркоза, йод и спирт - для обработки ран, гипсовую повязку при переломах","Сеченов (1829 - 1905) - создал естественно-научное направление в физиологии и работу \"Рефлексы головного мозга\"","Луи Пастер (1822 - 1895) - создание эффективных вакцин","Мечников (1845 - 1916) - создание эффективных вакцин","Карл Линней (1707 - 1778) - отводит человеку место в классификации рядом с человекоподобными обезьянами","Жорж-Луи де Бюффон (1707 - 1788) - отстаивал идею об изменяемости видов под влиянием условий среды","Жан-Батист Ламарк (1744 - 1829) - первая эволюционная теория","Чарльз Дарвин (1809 - 1882) - обосновал положение об общем предке людей и обезьян"]],["История - Идеологии",["Анархизм","Коммунизм","Социализм","Либерализм","Консерватизм"],["Основные идеи: Отрицание всякого насилия над личностью, устранение эксплуатации человека человеком; уничтожение государственной власти и создание федерации ассоциаций мелких производителей. Методы, формы достижения цели: Осуществление революции; мирные преобразования (реформы)","Основные идеи: Положение рабочего класса будет постоянно ухудшаться, в ходе классовой борьбы общество перейдёт к коммунизму, при котором деление на классы  исчезнет, люди получат возможности полного и гармоничного  развития. Методы, формы достижения цели: Создание революционных партий; объединение рабочих в I и II Интернационалы. Установление диктатуры пролетариата","Основные идеи: Общество устроено несправедливо создание общества социальной справедливости, без богатых и бедных. Методы, формы достижения цели: Убеждение: создание образцовых производств.","Основные идеи: Все люди от рождения равны и действуют для собственного блага; свобода предпринимательства; гражданские права и свободы личности: избирательное право на основе имущественного ценза. Методы, формы достижения цели: Введение конституций; контроль над королевской властью через парламент. Разделение властей","Основные идеи: Принцип порядка; защита традиционных основ общества и государства (религия и церковь, семья, монархия за веру царя и отечества), проверенных опытом многих поколений. Методы, формы достижения цели: Сохранение старого порядка; умеренные реформы, не меняющие основ общества."]],["Биология - Органоиды",["Плазматическая мембрана","Цитоплазма","Эндоплазматическая сеть (ЭПС)","Митохондрии","Рибосомы","Клеточный центр","Лизосомы","Комплекс Гольджи","Ядро","Ядрышко"],["Отделяет клетку от других клеток. Обладает избирательной проницательностью ","Объединяет все органоиды, транспортирует вещества, служит средой для протекания химических реакций ","Распределение веществ внутри клетки ","Вырабатывают энергию в результате биологического окисления, которая запасается в молекулах АТФ. При необходимости молекула расщепляется и энергия выделяется ","Синтез белков (биосинтез) ","Обеспечивает расхождение хромосом при делении клетки (включает в себя центриоли) ","Расщепление органических веществ; содержит в себе ферменты ","Создает более сложные вещества из веществ, поступивших из ЭПС, упаковывает их в цистерны для транспортировки по клетке ","Хранение и передача наследственной информации, которая хранится в хромосомах, состоящих из генов. Регулирует процессы жизнедеятельности","Синтез рибосом"]],["История - Даты и определения",["1814-1815","1815","1823","1832","1825","Секуляризация","Колониализм","Модернизация","Монополия","Протекторат","Венский конгресс","Создание Священного союза","Принятие в США доктрины Монро","Парламентская реформа в Англии","Первая железная дорога (Англия)"],["Венский конгресс","Создание Священного союза","Принятие в США доктрины Монро","Парламентская реформа в Англии","Первая железная дорога (Англия)","Освобождение чего-либо (культуры, политики, собственности) от религиозного влияния","Политика, направленная на эксплуатацию заморских территорий","Процесс перехода от традиционного аграрного общества к современному обществу индустриального капиталистического типа","Крупное объединение, возникшее на основе концентрации производства и стремящееся к увеличению прибыли за счёт полного или частичного контроля над рынком","Форма зависимости одного государства от другого, при которой во внутренних делах сохраняется самостоятельность, но во внешней политике она утрачивается","1814-1815","1815","1823","1832","1825"]]];
window.onresize = function() {
	questionDiv.style.width = Math.floor(window.innerWidth * 0.5) + "px";
	questionDiv.style.height = Math.floor(window.innerHeight * 0.5) + "px";
	questionDiv.style.position = "absolute";
	showAnswer.style.width = Math.floor(window.innerWidth * 0.5) + "px";
	showAnswer.style.height = Math.floor(window.innerHeight * 0.5) + "px";
	showAnswer.style.left = Math.floor(window.innerWidth * 0.5) + "px";
	showAnswer.style.position = "absolute";
	yes.style.width = Math.floor(window.innerWidth * 0.5) + "px";
	yes.style.height = Math.floor(window.innerHeight * 0.45) + "px";
	yes.style.position = "absolute";
	yes.style.top = Math.floor(window.innerHeight * 0.5) + "px";
	no.style.width = Math.floor(window.innerWidth * 0.5) + "px";
	no.style.height = Math.floor(window.innerHeight * 0.45) + "px";
	no.style.position = "absolute";
	no.style.top = Math.floor(window.innerHeight * 0.5) + "px";
	no.style.left = Math.floor(window.innerWidth * 0.5) + "px";
	if (restTest.length == 0) {
		progress.style.width = Math.floor(window.innerWidth * 0.5) + "px";
	} else {
		progress.style.width = Math.floor(window.innerWidth * (1 - restTest[1].length / tests[currentTest][1].length)) + "px";
	}
	progress.style.height = Math.floor(window.innerWidth) + "px";
	progress.style.position = "absolute";
	progress.style.top = Math.floor(window.innerHeight * 0.95) + "px";	
	final.style.width = Math.floor(window.innerWidth) + "px";
	final.style.height = Math.floor(window.innerHeight) + "px";
	final.style.position = "absolute";
	//checkTable.style.width = Math.floor(window.innerWidth) + "px";
	//checkTable.style.height = Math.floor(window.innerHeight) + "px";
	//checkTable.style.position = "absolute";
}
var currentTest = 0;
/*var restTest = [tests[currentTest], [], []];
for (var i = 0; i < tests[currentTest][1].length; i++) {
	restTest[1].push(tests[currentTest][1][i]);
	restTest[2].push(tests[currentTest][2][i]);
	console.log(tests[0][i]);
}*/
//var restTest = ["name1",["q11","q12","q13"],["a11","a12","a13"]];
var currentQuestion = 0;
var prevQuestion = -1; // чтобы избежать повторений
document.body.style.overflow = "visible";
var restTest = [];
var answeredOneAttempt = []; // ответил ли с первой попытки
var noPressed = 0;
window.onresize();
testsDiv.innerHTML += `<button class="ui" style="width: 250px; height: 100px; vertical-align: top; background: #ecac7d;" onclick="window.location.href = 'https://kfbgames.github.io/EasyLearn-How-to-use/';">Инструкция</button>`;
for (var i = tests.length - 1; i >= 0; i--) {
	testsDiv.innerHTML += `<button class="ui" style="width: 250px; height: 100px; vertical-align: top;" oncontextmenu="check(${i}); return false;" onclick="start(${i})">${tests[i][0]}</button>`;
}
testsDiv.innerHTML += `<button class="ui" style="width: 250px; height: 100px; vertical-align: top; background: #ecac7d;" onclick="window.location.href = 'https://forms.gle/71voW1niX8KmtB7X6';">Оставить отзыв</button>`;
function check(index) {
	mainDiv.style.display = 'none';
	testsDiv.style.display = 'none';
	checkTable.style.display = 'block';
	checkTable.innerHTML = "";
	for (var i = 0; i < tests[index][1].length; i++) {
		var style1 = "background: #fff6d3; width: 50%; border-radius: 5px;";
		var style2 = "width: 50%;";
		if (i % 2 == 0) {
			[style1, style2] = [style2, style1];
		}
		var question = tests[index][1][i];
		if (question.startsWith("*img*")) {
			style1 += "height: 300px;";
			style2 += "height: 300px;";
			question = `<img style="max-width: 100%; max-height: 100%;" src="images/${tests[index][0].replaceAll(" ", "_").replaceAll("/", "")}/${tests[index][1][i].slice(5)}">`;
		}
		checkTable.innerHTML += `<tr><td style="${style1}">${question}</td><td style="${style2}">${tests[index][2][i]}</td><tr>`;
	}
}
function start(index) {
	currentTest = index;
	document.body.style.overflow = 'hidden';
	mainDiv.style.display = 'block';
	testsDiv.style.display = 'none';
	checkTable.style.display = 'none';
	noPressed = 0;
	answeredOneAttempt = [];
	restTest = [tests[currentTest], [], []];
	for (var i = 0; i < tests[currentTest][1].length; i++) {
		restTest[1].push(tests[currentTest][1][i]);
		restTest[2].push(tests[currentTest][2][i]);
	}
	newQuestion();
}
function newQuestion() {
	showAnswer.innerHTML = "Показать ответ";
	progress.style.width = Math.floor(window.innerWidth * (1 - restTest[1].length / tests[currentTest][1].length)) + "px";
	//console.log(restTest[1].length / tests[currentTest][1].length);
	if (restTest[1].length == 0) {
		document.body.style.overflow = 'visible';
		mainDiv.style.display = 'none';
		final.style.display = 'block';
		checkTable.style.display = 'none';
		var answeredOneAttemptCount = 0;
		for (var i = 0; i < answeredOneAttempt.length; i++) {
			answeredOneAttempt[i] == true && answeredOneAttemptCount++;
		}
		final.innerHTML = "";
		if (answeredOneAttemptCount == tests[currentTest][1].length) {
			final.innerHTML = `МООЩЬ<br>`;
		}
		final.innerHTML += `Вы ответили с первой попытки на ${answeredOneAttemptCount}/${tests[currentTest][1].length} вопросов<br>Вы ошиблись ${noPressed} раз`;
		return;
	}
	if (prevQuestion == -1 || restTest[1].length == 1) {
		currentQuestion = Math.floor(Math.random() * restTest[1].length);
	} else {
		currentQuestion = Math.floor(Math.random() * (restTest[1].length - 1));
		if (currentQuestion >= prevQuestion) {
			currentQuestion++;
		}
	}
	prevQuestion = currentQuestion;
	if (restTest[1][currentQuestion].startsWith("*img*")) {
		var codeTestName = tests[currentTest][0].replaceAll(" ", "_");
		codeTestName = codeTestName.replaceAll("/", "");
		questionDiv.innerHTML = `<img style="max-width: 100%; max-height: 100%;" src="images/${codeTestName}/${restTest[1][currentQuestion].slice(5)}">`;
	} else {
		questionDiv.innerHTML = restTest[1][currentQuestion];
	}
	showAnswer.onclick = function() {
		if (showAnswer.innerHTML == restTest[2][currentQuestion]) {
			showAnswer.innerHTML = "Показать ответ";
		} else {
			showAnswer.innerHTML = restTest[2][currentQuestion];
		}
	}
}
no.onclick = function() {
	noPressed++;
	answeredOneAttempt[currentQuestion] = false;
	newQuestion();
}
yes.onclick = function() {
	if (answeredOneAttempt[tests[currentTest][1].indexOf(restTest[1][currentQuestion])] == undefined) {
		answeredOneAttempt[tests[currentTest][1].indexOf(restTest[1][currentQuestion])] = true;
	}
	//console.log(currentQuestion, );
	restTest[1].splice(currentQuestion, 1);
	restTest[2].splice(currentQuestion, 1);
	newQuestion();
}
final.onclick = function() {
	testsDiv.style.display = "block";
	final.style.display = 'none';
	mainDiv.style.display = "none";
	checkTable.style.display = 'none';
	return false;
}
questionDiv.oncontextmenu = final.onclick;
checkTable.oncontextmenu = function() {
	document.body.style.overflow = 'visible';
	mainDiv.style.display = 'none';
	testsDiv.style.display = 'block';
	checkTable.style.display = 'none';
	return false;
}
